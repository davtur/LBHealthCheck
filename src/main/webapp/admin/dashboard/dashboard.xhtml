
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/WEB-INF/template.xhtml" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui" >

    
        <ui:define name="title">
            <h:outputText value="#{configMapController.getKey('ListSessionHistoryTitle')}"></h:outputText>
        </ui:define>
        <ui:define name="body">
            <h:form id="listSessionHistoryForm1">
                <p:panelGrid columns="4" style="width:100%"  >
                   <!-- <p:outputLabel value="#{configMapController.getKey('SelectCustomerForSessionHistory_Label')}" for="sessionstart" />-->
                    <h:panelGrid columns="3" >
                        <p:selectOneMenu id="custForChart" disabled="#{mySessionsChart1.dashboardShowAllUsers}"  value="#{mySessionsChart1.selectedCustomer}"  valueChangeListener="#{mySessionsChart1.recreateDashboardModels}"  filter="true" converter="customersControllerConverter"  label="#{configMapController.getKey('SelectCustomerForSessionHistory_Title')}" required="true" requiredMessage="#{configMapController.getKey('CreateSessionHistoryRequiredMessage_trainer')}">
                            <f:selectItems value="#{customersController.activeCustomersAndStaff}"   var="cust" itemLabel="#{cust.firstname} #{cust.lastname}" itemValue="#{cust}"/>
                            <p:ajax   update=":listSessionHistoryForm1" />
                        </p:selectOneMenu>

                        <p:selectBooleanCheckbox id="showAllUsers"   value="#{mySessionsChart1.dashboardShowAllUsers}" valueChangeListener="#{mySessionsChart1.recreateDashboardModels}" >  
                            <p:ajax update="@form"   />  
                        </p:selectBooleanCheckbox> 

                        <p:outputLabel  value="#{configMapController.getKey('ShowAllUsersForSessionHistory_Title')}" for="showAllUsers"/>
                    </h:panelGrid>
                    <h:panelGrid columns="2" >
                    <p:outputLabel value="#{configMapController.getKey('SelectStartDateForSessionHistory_Label')}" for="sessionstart" />
                    <p:calendar id="sessionstart" value="#{mySessionsChart1.dashboardStartDate}" pattern="dd MMMM yyyy"
                                title="#{configMapController.getKey('SelectStartDateForSessionHistory_Title')}" valueChangeListener="#{mySessionsChart1.recreateDashboardModels}"   >
                        <p:ajax event="dateSelect"  update=":listSessionHistoryForm1"  />
                    </p:calendar> 
                    </h:panelGrid>
                     <h:panelGrid columns="2" >
                    <p:outputLabel value="#{configMapController.getKey('SelectEndDateForSessionHistory_Label')}" for="sessionend" />
                    <p:calendar id="sessionend" value="#{mySessionsChart1.dashboardEndDate}"  pattern="dd MMMM yyyy" valueChangeListener="#{mySessionsChart1.recreateDashboardModels}"
                                title="#{configMapController.getKey('SelectEndDateForSessionHistory_Title')}"    >
                        <p:ajax event="dateSelect"  update=":listSessionHistoryForm1"  />
                    </p:calendar> 
                    </h:panelGrid>
                   <!-- <p:outputLabel value="#{configMapController.getKey('SelectDateIntervalForSessionHistory_Label')}" for="chartInterval" />-->
                    <p:selectOneMenu id="chartInterval"   value="#{mySessionsChart1.dashboardDateInterval}"   label="#{configMapController.getKey('CreateSessionHistoryTitle_trainer')}" valueChangeListener="#{mySessionsChart1.recreateDashboardModels}" >
                        <f:selectItems value="#{mySessionsChart1.dateIntervalItems}" />                         
                        <p:ajax   update=":listSessionHistoryForm1" />
                    </p:selectOneMenu>
                </p:panelGrid>

                <p:panel id="customChart" widgetVar="customChartWidget" header="Sessions Chart ">
                    <p:chart type="bar"   styleClass="chartClass" model="#{mySessionsChart1.dashboardMonthlySessionsChartModel}"     />
                </p:panel>


                <p:panel id="dashboardMonthlyRevenueChart" widgetVar="dashboardMonthlyRevenueWidget" header="Monthly Revenue Chart ( Rolling 12 month )">
                    <p:chart type="bar"   styleClass="chartClass" model="#{mySessionsChart1.dashboardMonthlyRevenueModel}"     />
                </p:panel>
                        <div class="Container100">
                            <h:outputText escape="false" value="#{configMapController.getKey('ListCustomersEmpty')}" rendered="#{customersController.customersWithoutScheduledPayments.rowCount == 0}"/>
                            <h:panelGroup rendered="#{customersController.customersWithoutScheduledPayments.rowCount > 0}">
                                <p:dataTable id="customersTableList" 


                                             selection="#{customersController.multiSelected}" 
                                             rowKey="#{item.id}" 
                                             value="#{customersController.customersWithoutScheduledPayments}" 
                                             filteredValue="#{customersController.filteredCustomersWithoutScheduledPayments}" 
                                             widgetVar="customersControllerTable" 
                                             editable="false" 

                                             var="item"  
                                             scrollHeight="400"
                                             scrollable="true" >
                                    <f:facet name="header">


                                        <h:panelGroup>
                                            <h:outputText value="Search all fields:" />
                                            <p:inputText id="globalFilter" onkeyup="PF('customersControllerTable').filter();" />
                                        </h:panelGroup>
                                        <h:outputText value="   " />
                                        <h:panelGroup>
                                         <!--   <h:outputText  rendered="#{ customersController.filteredItems != null}" value="#{customersController.filteredItems.size} Records Found"/>-->
                                            <h:outputText  rendered="#{customersController.items != null}" value="#{customersController.items.rowCount} Records Found"/>


                                        </h:panelGroup>

                                    </f:facet>
                                    <p:ajax event="rowSelect"  listener="#{customersController.setSelecteDblClick}" update=":growl :tv:customerslistForm1:selectedUser :tv:formCustomersEdit1 :formCustomersCreate1 :tv:paymentsForm :tv:NoteslistForm1 :confirmCancellation :confirmDialogNotesCreate1"  />  
                                    <p:column selectionMode="multiple" />
                                    <p:column sortBy="#{item.id}" filterBy="#{item.id}" headerText="#{configMapController.getKey('ListCustomersTitle_id')}"   >
                                        <h:outputText value="#{item.id}"/>
                                    </p:column>

                                    <p:column sortBy="#{item.firstname}" filterBy="#{item.firstname}" headerText="#{configMapController.getKey('ListCustomersTitle_firstname')}"   >
                                        <h:outputText value="#{item.firstname}"/>
                                    </p:column>
                                    <p:column sortBy="#{item.lastname}" filterBy="#{item.lastname}" headerText="#{configMapController.getKey('ListCustomersTitle_lastname')}"   >
                                        <h:outputText value="#{item.lastname}"/>
                                    </p:column>
                                    <p:column sortBy="#{item.active.customerState}" filterBy="#{item.active.customerState}" headerText="#{configMapController.getKey('ListCustomersTitle_activeCRM')}"   >
                                       <h:outputText value="LEAD, " rendered="#{customersController.isCustomerInRole(item,'LEAD')}" />  <h:outputText value="TRAINER, " rendered="#{customersController.isCustomerInRole(item,'TRAINER')}" /> <h:outputText value="#{item.active.customerState}"/>                                       
                                    </p:column>
                                    <p:column sortBy="#{item.paymentParameters.statusDescription}" filterBy="#{item.paymentParameters.statusDescription}" headerText="#{configMapController.getKey('ListCustomersTitle_activeEZI')}"   >
                                        <h:outputText value="#{item.paymentParameters.statusDescription}"/> 
                                    </p:column>
                                    <p:column sortBy="#{item.paymentParameters.contractStartDate}" filterBy="#{item.paymentParameters.contractStartDate}" headerText="#{configMapController.getKey('ListCustomersTitle_contractStartDate')}"   >
                                        <h:outputText value="#{item.paymentParameters.contractStartDate}">
                                            <f:convertDateTime pattern="dd MMM yyyy" />
                                        </h:outputText>
                                    </p:column>
                                    <p:column sortBy="#{item.paymentParameters.paymentPeriod}" filterBy="#{item.paymentParameters.paymentPeriod}" headerText="#{configMapController.getKey('ListCustomersTitle_paymentPeriod')}"   >

                                        <h:outputText  rendered="#{item.paymentParameters.paymentPeriod == 'F'}"  value="Fortnightly" />
                                        <h:outputText  rendered="#{item.paymentParameters.paymentPeriod == 'M'}"  value="Monthly" />
                                        <h:outputText  rendered="#{item.paymentParameters.paymentPeriod == '4'}"  value="4 Weekly" />
                                        <h:outputText  rendered="#{item.paymentParameters.paymentPeriod == 'N'}"  value="Weekday in Month" />
                                        <h:outputText  rendered="#{item.paymentParameters.paymentPeriod == 'Q'}"  value="Quarterly" />
                                        <h:outputText  rendered="#{item.paymentParameters.paymentPeriod == 'H'}"  value="Half Yearly" />
                                        <h:outputText  rendered="#{item.paymentParameters.paymentPeriod == 'Y'}"  value="Annually" />
                                        <h:outputText  rendered="#{item.paymentParameters.paymentPeriod == 'W'}"  value="Weekly" />
                                        <h:outputText  rendered="#{item.paymentParameters.paymentPeriod == 'Z'}"  value="No Schedule" />
                                        <h:outputText  rendered="#{item.paymentParameters.paymentPeriod != 'Z' and item.paymentParameters.paymentPeriod != 'M' and item.paymentParameters.paymentPeriod != 'Q' and item.paymentParameters.paymentPeriod != 'H' and item.paymentParameters.paymentPeriod != 'Y' }"  value=" - #{item.paymentParameters.paymentPeriodDayOfWeek}"/> 
                                        <h:outputText  rendered="#{item.paymentParameters.paymentPeriod != 'Z' and item.paymentParameters.paymentPeriod == 'M' }"  value=", day-#{item.paymentParameters.paymentPeriodDayOfMonth}"/> 

                                    </p:column>

                                    
                                    

                                </p:dataTable>
                            </h:panelGroup>
                        </div>

            </h:form>
           
        </ui:define>

    </ui:composition>


