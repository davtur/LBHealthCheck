<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui" >

    <ui:composition template="/template.xhtml">
        <ui:define name="title">
            <h:outputText value="#{configMapController.getKey('ListCustomersTitle')}"></h:outputText>
        </ui:define>
        <ui:define name="body">


            <h:form id="pollForm">
              <!--  <p:poll  id="poller1" widgetVar="paymentPoller" interval="3" listener="#{ezidebit.pollerListener}" autoStart="#{ezidebit.autoStartPoller}" stop="#{ezidebit.paymentRequestStatusIdle}" update=":tabView:paymentsForm :growl"  />-->
                <p:poll  id="poller1"   widgetVar="paymentPoller" interval="5"   listener="#{ezidebit.pollerListener}" autoStart="false"  update=":tabView:paymentsForm :growl" oncomplete="handlePollComplete(xhr, status, args,'paymentPoller')" />

            </h:form>


            <p:tabView id="tabView" widgetVar="tabViewWidget" > 
                <p:ajax event="tabChange"  update=":growl :pollForm:poller1"   oncomplete="PF('paymentPoller').start();"/>  

                <p:tab id="tab1" title="Customer List">  
                    <h:form id="CustomerslistForm1">
                        <h:panelGroup >
                            <p:commandButton id="showDialogButton"  oncomplete="PF('customersCreateDialogue').show()"   actionListener="#{customersController.prepareCreateAjax}" value="#{configMapController.getKey('ListCustomersCreateLink')}"  update=":formCustomersCreate1:dialogueGrid" /> 

                        </h:panelGroup>
                        <h:outputText id="selectedUser" value="#{customersController.selected.firstname} #{customersController.selected.lastname}" />
                        <h:outputText escape="false" value="#{configMapController.getKey('ListCustomersEmpty')}" rendered="#{customersController.items.rowCount == 0}"/>
                        <h:panelGroup rendered="#{customersController.items.rowCount > 0}">
                            <p:dataTable id="customersTableList" editable="true"   rowKey="#{item.id}" selection="#{customersController.selected}" value="#{customersController.items}" filteredValue="#{customersController.filteredItems}"  widgetVar="customersControllerTable" var="item"  paginator="true" rows="15"  paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  rowsPerPageTemplate="5,10,15,20,25,50,100" >
                                <f:facet name="header">
                                    <p:outputPanel>
                                        <h:outputText value="Search all fields:" />
                                        <h:inputText id="globalFilter4" onkeyup="customersControllerTable.filter()" />
                                    </p:outputPanel>
                                </f:facet>
                                <p:ajax event="rowEdit"   listener="#{customersController.onEdit}" update=":growl"  />  
                                <p:ajax event="rowEditCancel" listener="#{customersController.onCancel}" update=":growl"   /> 
                                <p:ajax event="rowSelectRadio"   update=":growl :tabView:CustomerslistForm1:selectedUser :tabView:formCustomersEdit1 :formCustomersCreate1 :pollForm:poller1 :tabView:paymentsForm :tabView:NoteslistForm1"  />  

                                <p:column selectionMode="single"/>
                                <p:column sortBy="#{item.firstname}" filterBy="#{item.firstname}" headerText="#{configMapController.getKey('ListCustomersTitle_firstname')}"   >
                                    <p:cellEditor> 
                                        <f:facet name="output">
                                            <h:outputText value="#{item.firstname}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText value="#{item.firstname}" label="#{configMapController.getKey('ListCustomersTitle_firstname')}" />
                                        </f:facet>
                                    </p:cellEditor> 
                                </p:column>
                                <p:column sortBy="#{item.lastname}" filterBy="#{item.lastname}" headerText="#{configMapController.getKey('ListCustomersTitle_lastname')}"   >
                                    <p:cellEditor> 
                                        <f:facet name="output">
                                            <h:outputText value="#{item.lastname}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText value="#{item.lastname}" label="#{configMapController.getKey('ListCustomersTitle_lastname')}" />
                                        </f:facet>
                                    </p:cellEditor> 


                                </p:column>
                                <p:column sortBy="#{item.dob}" filterBy="#{item.dob}" headerText="#{configMapController.getKey('ListCustomersTitle_dob')}"   >

                                    <p:cellEditor> 
                                        <f:facet name="output">
                                            <h:outputText value="#{item.dob}">
                                                <f:convertDateTime pattern="dd MMM yyyy" />
                                            </h:outputText>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:calendar value="#{item.dob}">	
                                                <p:ajax event="dateSelect" listener= "#{customersController.handleDateSelect}" update=":growl" />
                                            </p:calendar>
                                        </f:facet>
                                    </p:cellEditor> 

                                </p:column>
                                <p:column sortBy="#{item.emailAddress}" filterBy="#{item.emailAddress}" headerText="#{configMapController.getKey('ListCustomersTitle_emailAddress')}"   >
                                    <p:cellEditor> 
                                        <f:facet name="output">
                                            <h:outputText value="#{item.emailAddress}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText value="#{item.emailAddress}" label="#{configMapController.getKey('ListCustomersTitle_emailAddress')}" />
                                        </f:facet>
                                    </p:cellEditor> 


                                </p:column>


                                <p:column sortBy="#{item.active.customerState}" filterBy="#{item.active.customerState}" headerText="#{configMapController.getKey('ListCustomersTitle_active')}"   >
                                    <p:cellEditor> 
                                        <f:facet name="output">
                                            <h:outputText value="#{item.active.customerState}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:selectOneMenu id="active" valueChangeListener="#{customersController.selectOneMenuValueChangeListener}" converter="customerStateConverter" value="#{item.active}" label="#{configMapController.getKey('CreateCustomersTitle_active')}" >
                                                <f:selectItems value="#{customerStateController.itemsAvailableAsObjects}"  var="custState" itemLabel="#{custState.customerState}" itemValue="#{custState}"/>                           
                                            </p:selectOneMenu>

                                        </f:facet>
                                    </p:cellEditor> 
                                </p:column>


                                <p:column rendered="#{customersController.isUserInRole('ADMIN')}"  headerText="Edit" style="width:50px">  
                                    <p:rowEditor />  
                                </p:column>  
                            </p:dataTable>
                        </h:panelGroup>
                    </h:form>
                </p:tab>


                <p:tab id="tab2" title="Edit Customer Details"  >  
                    <h:form id="formCustomersEdit1">    
                        <!-- <p:log />-->
                        <p:panelGrid id="dialogueGrid1" columns="4">
                            <p:outputLabel value="#{configMapController.getKey('EditCustomersLabel_firstname')}" for="firstname1" />
                            <p:inputText id="firstname1"  value="#{customersController.selected.firstname}" title="#{configMapController.getKey('EditCustomersTitle_firstname')}" valueChangeListener="#{customersController.firstNameListener}" required="true" requiredMessage="#{configMapController.getKey('EditCustomersRequiredMessage_firstname')}">
                                <p:ajax update=":tabView:formCustomersEdit1:username1" event="keyup"/>
                            </p:inputText>
                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_gender')}" title="#{configMapController.getKey('EditCustomersTitle_gender')}" for="gender1" />
                            <p:selectOneMenu id="gender1" value="#{customersController.selected.gender}"   required="true" requiredMessage="#{configMapController.getKey('EditCustomersRequiredMessage_gender')}">
                                <f:selectItem itemValue="M" itemLabel="Male" />
                                <f:selectItem itemValue="F" itemLabel="Female" />
                            </p:selectOneMenu>
                            <p:outputLabel value="#{configMapController.getKey('EditCustomersLabel_lastname')}" for="lastname1" />
                            <p:inputText id="lastname1" value="#{customersController.selected.lastname}" title="#{configMapController.getKey('EditCustomersTitle_lastname')}" valueChangeListener="#{customersController.lastNameListener}" required="true" requiredMessage="#{configMapController.getKey('EditCustomersRequiredMessage_lastname')}">
                                <p:ajax update=":tabView:formCustomersEdit1:username1" event="keyup" />
                            </p:inputText>
                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_dob')}" for="dob1" />
                            <p:calendar id="dob1" pattern="MM/dd/yyyy" value="#{customersController.selected.dob}" title="#{configMapController.getKey('CreateCustomersTitle_dob')}" required="true" requiredMessage="#{configMapController.getKey('CreateCustomersRequiredMessage_dob')}">
                            </p:calendar>
                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_emailAddress')}" for="emailAddress1" />
                            <p:inputText id="emailAddress1" value="#{customersController.selected.emailAddress}" title="#{configMapController.getKey('EditCustomersTitle_emailAddress')}" required="true" requiredMessage="#{configMapController.getKey('EditCustomersRequiredMessage_emailAddress')}">
                                <f:validator validatorId="au.com.manlyit.fitnesscrm.stats.classes.util.EmailValidator" />
                            </p:inputText>
                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_username')}" for="username1" />
                            <p:inputText id="username1" value="#{customersController.selected.username}" title="#{configMapController.getKey('CreateCustomersTitle_username')}" required="true" requiredMessage="#{configMapController.getKey('CreateCustomersRequiredMessage_username')}"/>
                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_streetAddress')}" for="streetAddress1" />
                            <p:inputText id="streetAddress1" value="#{customersController.selected.streetAddress}" title="#{configMapController.getKey('CreateCustomersTitle_streetAddress')}" />
                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_suburb')}" for="suburb1" />
                            <p:inputText id="suburb1" value="#{customersController.selected.suburb}" title="#{configMapController.getKey('CreateCustomersTitle_suburb')}" />
                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_postcode')}" for="postcode1" />
                            <p:inputText id="postcode1" value="#{customersController.selected.postcode}" title="#{configMapController.getKey('CreateCustomersTitle_postcode')}" />
                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_city')}" for="city1" />
                            <p:inputText id="city1" value="#{customersController.selected.city}" title="#{configMapController.getKey('CreateCustomersTitle_city')}" />
                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_addrState')}" for="addrState1" />
                            <p:inputText id="addrState1" value="#{customersController.selected.addrState}" title="#{configMapController.getKey('CreateCustomersTitle_addrState')}" />
                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_countryId')}" for="countryId1" />
                            <p:inputText id="countryId1" value="#{customersController.selected.countryId}" title="#{configMapController.getKey('CreateCustomersTitle_countryId')}" />
                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_telephone')}" for="telephone1" />
                            <p:inputText id="telephone1" value="#{customersController.selected.telephone}" title="#{configMapController.getKey('CreateCustomersTitle_telephone')}" />
                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_fax')}" for="fax1" />
                            <p:inputText id="fax1" value="#{customersController.selected.fax}" title="#{configMapController.getKey('CreateCustomersTitle_fax')}" />


                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_newsletter')}" title="#{configMapController.getKey('EditCustomersTitle_newsletter')}" for="newsletter1" />
                            <p:selectOneMenu id="newsletter1" value="#{customersController.selected.newsletter}"  >
                                <f:selectItem itemValue="Y" itemLabel="Send Newsletter" />
                                <f:selectItem itemValue="N" itemLabel="Dont Send" />
                            </p:selectOneMenu>

                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_referredby')}"  title="#{configMapController.getKey('EditCustomersTitle_referredby')}"  for="referredby1" />
                            <p:selectOneMenu id="referredby1" value="#{customersController.selected.referredby}"   >
                                <f:selectItems value="#{customersController.itemsAvailableSelectOne}"  />
                            </p:selectOneMenu>

                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_active')}" for="active1" />
                            <p:selectOneMenu id="active1" valueChangeListener="#{customersController.selectOneMenuValueChangeListener}" converter="customerStateConverter" value="#{customersController.selected.active}" label="#{configMapController.getKey('CreateCustomersTitle_active')}" >
                                <f:selectItems value="#{customerStateController.itemsAvailableAsObjects}"  var="custState" itemLabel="#{custState.customerState}" itemValue="#{custState}"/>                           
                            </p:selectOneMenu>
                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_groupPricing')}" for="groupPricing1" />
                            <p:selectOneMenu id="groupPricing1" valueChangeListener="#{customersController.selectOneMenuValueChangeListener}" converter="planConverter" value="#{customersController.selected.groupPricing}" label="#{configMapController.getKey('CreateCustomersTitle_groupPricing')}" >
                                <f:selectItems value="#{planController.itemsAvailableAsObjects}"  var="plan" itemLabel="#{plan.planName}" itemValue="#{plan}"/>
                            </p:selectOneMenu>
                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_emailFormat')}" for="emailFormat1" />
                            <p:selectOneMenu id="emailFormat1" valueChangeListener="#{customersController.selectOneMenuValueChangeListener}" converter="emailFormatConverter" value="#{customersController.selected.emailFormat}" label="#{configMapController.getKey('CreateCustomersTitle_emailFormat')}" >
                                <f:selectItems value="#{emailFormatController.itemsAvailableAsObjects}"  var="emailFormat" itemLabel="#{emailFormat.emailFormat}" itemValue="#{emailFormat}"/>
                            </p:selectOneMenu>
                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_auth')}" for="auth1" />
                            <p:selectOneMenu id="auth1" valueChangeListener="#{customersController.selectOneMenuValueChangeListener}" converter="customerAuthConverter" value="#{customersController.selected.auth}" label="#{configMapController.getKey('CreateCustomersTitle_auth')}" >
                                <f:selectItems value="#{customerAuthController.itemsAvailableAsObjects}"  var="custAuth" itemLabel="#{custAuth.customerAuthType}" itemValue="#{custAuth}"/>
                            </p:selectOneMenu>
                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_demographic')}" for="demographic1" />
                            <p:selectOneMenu id="demographic1" valueChangeListener="#{customersController.selectOneMenuValueChangeListener}" converter="demographicTypesConverter" value="#{customersController.selected.demographic}" label="#{configMapController.getKey('CreateCustomersTitle_demographic')}" >
                                <f:selectItems value="#{demographicTypesController.itemsAvailableAsObjects}"  var="demo" itemLabel="#{demo.name}" itemValue="#{demo}"/>
                            </p:selectOneMenu>
                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_preferredContact')}" for="preferredContact1" />
                            <p:selectOneMenu id="preferredContact1" valueChangeListener="#{customersController.selectOneMenuValueChangeListener}" converter="preferedContactConverter" value="#{customersController.selected.preferredContact}" label="#{configMapController.getKey('CreateCustomersTitle_preferredContact')}" >
                                <f:selectItems value="#{preferedContactController.itemsAvailableAsObjects}"  var="prefContact" itemLabel="#{prefContact.preferedContactMethod}" itemValue="#{prefContact}"/>
                            </p:selectOneMenu>
                            <p:outputLabel value="#{configMapController.getKey('CreateCustomersLabel_password')}" for="password1" />
                            <p:password id="password1"  value="#{customersController.checkPass}" onfocus="this.select()" feedback="true" title="#{configMapController.getKey('EditCustomersTitle_password')}">
                                <p:ajax listener="#{customersController.checkPassChange}" event="keyup" />
                            </p:password>
                            <p:commandButton  id="passButton" ajax="true" actionListener="#{customersController.updatepass}" update=":growl"   value="#{configMapController.getKey('EditCustomersUpdatePassword')}" immediate="true"/>
                            <p:panel>
                                <p:commandButton id="dialogueSave1" oncomplete="tabViewWidget.select(1)"  actionListener="#{customersController.createDialogue}" value="#{configMapController.getKey('CreateCustomersSaveLink')}" update=":tabView:CustomerslistForm1:customersTableList :growl"/>                
                            </p:panel>
                        </p:panelGrid>
                    </h:form>
                </p:tab>


                <p:tab id="tab3" title="Payment Information" rendered="#{ezidebit.paymentGatewayEnabled}" >  
                    <h:form id="paymentsForm" > 
                        <p:panel id="progressBarPanel" rendered="#{!ezidebit.paymentRequestStatusIdle}" >

<!--<p:progressBar id="progressBar1" widgetVar="pbAjax" ajax="true" value="#{ezidebit.progress}" labelTemplate="{value}%" styleClass="animated"  interval="2000">  
    <p:ajax event="complete" listener="#{ezidebit.onComplete}" update="@form, :growl" oncomplete="pbAjax.cancel()" process="@form"/>  
</p:progressBar>  -->
                            <h:outputText id="statusText" value="Please wait while the payment data for #{customersController.selected.firstname} #{customersController.selected.lastname} is loaded..." />
                        </p:panel>
                        <p:outputPanel id="mainPanel" rendered="#{ezidebit.paymentRequestStatusIdle and ezidebit.customerDetailsHaveBeenRetrieved == true}" >
                            <p:selectBooleanButton value="#{ezidebit.editPaymentDetails}" onLabel="Refresh View" offLabel="Refresh View" rendered="#{ezidebit.customerExistsInPaymentGateway}" >
                                <p:ajax update=":tabView:paymentsForm:viewPaymentsGrid  :tabView:paymentsForm:editPaymentsGrid  :growl" process=":tabView:paymentsForm:viewPaymentsGrid  :tabView:paymentsForm:editPaymentsGrid :pollForm:poller1"/>  
                            </p:selectBooleanButton>  
                            <p:commandButton id="showAddPaymentButton"  oncomplete="PF('createPaymentDialogueWidget').show();PF('paymentPoller').start();"    value="#{configMapController.getKey('AddPaymentButtonLink')}"  update=":growl :pollForm:poller1" /> 
                            <p:commandButton id="showAddPaymentScheduleButton"  oncomplete="PF('createPaymentScheduleDialogueWidget').show();PF('paymentPoller').start();"    value="#{configMapController.getKey('AddPaymentScheduleButtonLink')}" update=":growl :pollForm:poller1"  /> 
                            <h:outputText rendered="#{ezidebit.paymentRequestStatusIdle}" value="Idle"/>
                            <h:outputText rendered="#{!ezidebit.paymentRequestStatusIdle}" value="Busy"/>
                        </p:outputPanel>
                        <p:outputPanel id="iFramePanel" >
                            <p:panelGrid id="dialoguePaymenstGrid1" columns="2" rendered="#{ezidebit.customerExistsInPaymentGateway == false and ezidebit.customerDetailsHaveBeenRetrieved == true}" >
                                <p:commandButton  id="paymentsButton" ajax="true"  oncomplete="PF('paymentPoller').start();"  actionListener="#{ezidebit.createCustomerRecord}" update=":growl :tabView:paymentsForm :pollForm:poller1"   value="#{configMapController.getKey('EditCustomersUpdatePayment')}" immediate="true"/>
                                <p:outputLabel value="#{configMapController.getKey('EditCustomersAddToPaymentGatewayLabel')}" for="paymentsButton" />
                            </p:panelGrid>
                            <h:outputText id="selectedUser2" value="#{customersController.selected.firstname} #{customersController.selected.lastname}" />
                            <p:panelGrid id="dialoguePaymenstGrid2" columns="2" rendered="#{ezidebit.customerExistsInPaymentGateway and ezidebit.customerDetailsHaveBeenRetrieved == true}" >
                                <p:panel id="viewPaymentsGrid"  >
                                    <iframe id="ezidebitIframeView"  style="width:400px;height:400px" src="#{ezidebit.getEziDebitWidgetUrl(false)}" />
                                </p:panel>
                                <p:panel id="editPaymentsGrid" >
                                    <p:outputLabel value="Edit Payment Details"/> <br/>
                                    <iframe id="ezidebitIframeEdit"  style="width:400px;height:400px" src="#{ezidebit.getEziDebitWidgetUrl(true)}" />
                                </p:panel>
                            </p:panelGrid>

                        </p:outputPanel>
                        <h:panelGroup  id="paymentsTablePanel" rendered="#{ezidebit.paymentsList != null}">
                            <p:dataTable  editable="true" 
                                          value="#{ezidebit.paymentsList}" 
                                          filteredValue="#{ezidebit.paymentsListFilteredItems}"  
                                          widgetVar="paymentsListControllerTable"
                                          var="pay"  
                                          paginator="true" rows="15"  
                                          paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                          rowsPerPageTemplate="5,10,15,20,25,50,100" >
                                <f:facet name="header">
                                    <p:outputPanel>
                                        <h:outputText value="Payments            --          Search all fields:" />
                                        <h:inputText id="globalFilter3" onkeyup="paymentsListControllerTable.filter()" />
                                    </p:outputPanel>
                                </f:facet>
                                <p:column sortBy="#{pay.customerName.value}" filterBy="#{pay.customerName.value}" headerText="#{configMapController.getKey('ListPaymentsTitle_customerName')}"   >
                                    <p:cellEditor> 
                                        <f:facet name="output">
                                            <h:outputText value="#{pay.customerName.value}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText value="#{pay.customerName.value}" label="#{configMapController.getKey('ListPaymentsTitle_customerName')}" />
                                        </f:facet>
                                    </p:cellEditor> 
                                </p:column>
                                <p:column sortBy="#{pay.paymentReference.value}" filterBy="#{pay.paymentReference.value}" headerText="#{configMapController.getKey('ListPaymentsTitle_paymentReference')}"   >
                                    <p:cellEditor> 
                                        <f:facet name="output">
                                            <h:outputText value="#{pay.paymentReference.value}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText value="#{pay.paymentReference.value}" label="#{configMapController.getKey('ListPaymentsTitle_paymentReference')}" />
                                        </f:facet>
                                    </p:cellEditor> 
                                </p:column>
                                <p:column sortBy="#{pay.paymentAmount}" filterBy="#{pay.paymentAmount}" headerText="#{configMapController.getKey('ListPaymentsTitle_paymentAmount')}"   >
                                    <p:cellEditor> 
                                        <f:facet name="output">
                                            <h:outputText value="#{pay.paymentAmount}">
                                                <f:convertNumber type="currency" currencySymbol="$" locale="au-AU" />
                                            </h:outputText>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText value="#{pay.paymentAmount}" label="#{configMapController.getKey('ListPaymentsTitle_paymentAmount')}" />
                                        </f:facet>
                                    </p:cellEditor> 
                                </p:column>
                                <p:column sortBy="#{pay.paymentStatus.value}" filterBy="#{pay.paymentStatus.value}" headerText="#{configMapController.getKey('ListPaymentsTitle_paymentStatus')}"   >

                                    <h:outputText  rendered="#{pay.paymentStatus.value == 'W'}"  value="Waiting"/>
                                    <h:outputText  rendered="#{pay.paymentStatus.value == 'P'}"  value="Pending"/>
                                    <h:outputText  rendered="#{pay.paymentStatus.value == 'S'}"  value="Successful"/>
                                    <h:outputText  rendered="#{pay.paymentStatus.value == 'D'}"  value="Dis.Insufficient Funds"/>
                                    <h:outputText  rendered="#{pay.paymentStatus.value == 'F'}"  value="Dishonoured"/>

                                </p:column>
                                <p:column sortBy="#{pay.debitDate.value.toGregorianCalendar().time}" filterBy="#{pay.debitDate.value.toGregorianCalendar().time}" headerText="#{configMapController.getKey('ListPaymentsTitle_debitDate')}"   >
                                    <p:cellEditor> 
                                        <f:facet name="output">
                                            <h:outputText value="#{pay.debitDate.value.toGregorianCalendar().time}">
                                                <f:convertDateTime pattern="dd MMM yyyy" />
                                            </h:outputText>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText value="#{pay.debitDate.value.toGregorianCalendar().time}" label="#{configMapController.getKey('ListPaymentsTitle_debitDate')}" >
                                                <f:convertDateTime pattern="dd MMM yyyy" />
                                            </p:inputText>
                                        </f:facet>
                                    </p:cellEditor> 
                                </p:column>

                            </p:dataTable>
                        </h:panelGroup>
                         
                        <h:panelGroup id="scheduledPaymentsTablePanel" rendered="#{ezidebit.scheduledPaymentsList != null}">
                            <p:dataTable  editable="true" 
                                          selection="#{ezidebit.selectedScheduledPayment}" 
                                          value="#{ezidebit.scheduledPaymentsList}" 
                                          filteredValue="#{ezidebit.scheduledPaymentsListFilteredItems}" 
                                          rowKey="#{payment.id}"
                                          widgetVar="scheduledPaymentsListControllerTable" 
                                          var="payment"  
                                          paginator="true" rows="15"  
                                          paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                          rowsPerPageTemplate="5,10,15,20,25,50,100" >
                                <f:facet name="header">
                                    <p:outputPanel>
                                        <h:outputText value="    Scheduled Payments               --               Search all fields:" />
                                        <h:inputText id="globalFilter" onkeyup="scheduledPaymentsListControllerTable.filter()" />
                                    </p:outputPanel>
                                </f:facet>
                                <p:ajax event="rowSelect"   update="deleteButton"/>
                                <p:ajax event="rowUnselect" update="deleteButton"/>
                                <p:column selectionMode="single"/>

                                <p:column sortBy="#{payment.yourGeneralReference}" filterBy="#{payment.yourGeneralReference}" headerText="#{configMapController.getKey('ListPaymentsTitle_customerName')}"   >
                                    <h:outputText value="#{payment.yourGeneralReference}"/>
                                </p:column>
                                <p:column sortBy="#{payment.paymentReference}" filterBy="#{payment.paymentReference}" headerText="#{configMapController.getKey('ListPaymentsTitle_paymentReference')}"   >                                 
                                    <p:cellEditor> 
                                        <f:facet name="output">
                                            <h:outputText value="#{payment.paymentReference}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText value="#{payment.paymentReference}" label="#{configMapController.getKey('ListPaymentsTitle_paymentReference')}" />
                                        </f:facet>
                                    </p:cellEditor> 
                                </p:column>
                                <p:column sortBy="#{payment.paymentAmount}" filterBy="#{payment.paymentAmount}" headerText="#{configMapController.getKey('ListPaymentsTitle_paymentAmount')}"   >
                                    <p:cellEditor> 
                                        <f:facet name="output">
                                            <h:outputText value="#{payment.paymentAmount}">
                                                <f:convertNumber type="currency" currencySymbol="$" locale="au-AU" />
                                            </h:outputText>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText value="#{payment.paymentAmount}" label="#{configMapController.getKey('ListPaymentsTitle_paymentAmount')}" />
                                        </f:facet>
                                    </p:cellEditor> 
                                </p:column>
                                <p:column sortBy="#{payment.paymentDate}" filterBy="#{payment.paymentDate}" headerText="#{configMapController.getKey('ListPaymentsTitle_debitDate')}"   >
                                    <p:cellEditor> 
                                        <f:facet name="output">
                                            <h:outputText value="#{payment.paymentDate}" >
                                                <f:convertDateTime pattern="dd MMM yyyy" />
                                            </h:outputText>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText value="#{payment.paymentDate}" label="#{configMapController.getKey('ListPaymentsTitle_debitDate')}" >
                                                <f:convertDateTime pattern="dd MMM yyyy" />
                                            </p:inputText>
                                        </f:facet>
                                    </p:cellEditor> 
                                </p:column>
                                <p:column sortBy="#{payment.isManuallyAddedPayment()}" filterBy="#{payment.isManuallyAddedPayment()}" headerText="#{configMapController.getKey('ListPaymentsTitle_manualPayment')}"   >
                                    <h:outputText rendered="#{payment.isManuallyAddedPayment()}" value="Manual"/>
                                    <h:outputText rendered="#{!payment.isManuallyAddedPayment()}" value="Auto"/>
                                </p:column>
                                <f:facet name="footer">
                                    <p:commandButton rendered="#{fitnessTestChartsController.isUserInRole('ADMIN')}" id="deleteButton" icon="ui-icon-trash" oncomplete="PF('paymentPoller').start();" value="#{configMapController.getKey('Delete')}" actionListener="#{ezidebit.deleteScheduledPayment}" update=":growl :pollForm:poller1" disabled="#{empty fitnessTestChartsController.selected}"/>
                                </f:facet>

                            </p:dataTable>
                        </h:panelGroup>

                    </h:form>  
                </p:tab>


                <p:tab id="tab4" title="Customer Notes"  >  

                    <h:form id="formNotesCreate1">
                        <p:confirmDialog id="confirmDialogNotesCreate1" message="Add Customer Natoes"  
                                         header="#{configMapController.getKey('CreateNotesTitle')}" severity="info" widgetVar="NotesCreateDialogue"> 

                            <p:panelGrid columns="2">
                                <p:outputLabel value="#{configMapController.getKey('CreateNotesLabel_note')}" for="note" />
                                <p:inputTextarea rows="4" cols="30" id="note" value="#{notesController.selected.note}" title="#{configMapController.getKey('CreateNotesTitle_note')}" />
                                <p:commandButton oncomplete="NotesCreateDialogue.hide();notesControllerTable.filter()" actionListener="#{notesController.createDialogue}" value="#{configMapController.getKey('CreateNotesSaveLink')}" update=":growl :tabView:NoteslistForm1 :tabView:formNotesCreate1"/>                
                            </p:panelGrid>
                        </p:confirmDialog>
                    </h:form>
                    <h:form id="NoteslistForm1">
                        <h:panelGroup >
                            <p:commandButton id="showDialogButton2"  value="#{configMapController.getKey('ListNotesCreateLink')}" onclick="NotesCreateDialogue.show()" type="button"/> 

                        </h:panelGroup> 
                        <h:outputText id="selectedUser3" value="#{customersController.selected.firstname} #{customersController.selected.lastname}" />
                        <h:outputText escape="false" value="#{configMapController.getKey('ListNotesEmpty')}" rendered="#{customersController.notesItems.rowCount == 0}"/>
                        <h:panelGroup rendered="#{customersController.notesItems.rowCount > 0}">
                            <p:dataTable  editable="true" value="#{customersController.notesItems}" filteredValue="#{customersController.notesFilteredItems}"  widgetVar="notesControllerTable" var="item"  paginator="true" rows="15"  paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  rowsPerPageTemplate="5,10,15,20,25,50,100" >
                                <f:facet name="header">
                                    <p:outputPanel>
                                        <h:outputText value="Search all fields:" />
                                        <h:inputText id="globalFilter2" onkeyup="notesControllerTable.filter()" />
                                    </p:outputPanel>
                                </f:facet>
                                <p:ajax event="rowEdit" listener="#{customersController.onNotesEdit}" update=":growl" oncomplete="notesControllerTable.filter()" />  
                                <p:ajax event="rowEditCancel" listener="#{customersController.onNotesCancel}" update=":growl"  oncomplete="notesControllerTable.filter()" />  

                                <p:column sortBy="#{item.createTimestamp}" filterBy="#{item.createTimestamp}" headerText="#{configMapController.getKey('ListNotesTitle_createTimestamp')}"   >

                                    <p:cellEditor> 
                                        <f:facet name="output">
                                            <h:outputText value="#{item.createTimestamp}">
                                                <f:convertDateTime pattern="MM/dd/yyyy HH:mm:ss" />
                                            </h:outputText>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:calendar value="#{item.createTimestamp}">	
                                                <p:ajax event="dateSelect" listener= "#{notesController.handleDateSelect}" update=":growl" />
                                            </p:calendar>
                                        </f:facet>
                                    </p:cellEditor> 

                                </p:column>

                                <p:column sortBy="#{item.note}" filterBy="#{item.note}" headerText="#{configMapController.getKey('ListNotesTitle_note')}"   >
                                    <p:cellEditor> 
                                        <f:facet name="output">
                                            <h:outputText value="#{item.note}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText value="#{item.note}" label="#{configMapController.getKey('ListNotesTitle_note')}" />
                                        </f:facet>
                                    </p:cellEditor> 


                                </p:column>
                                <!--         <p:column sortBy="#{item.deleted}" filterBy="#{item.deleted}" headerText="#{configMapController.getKey('ListNotesTitle_deleted')}"   >
                                       <p:cellEditor> 
                                           <f:facet name="output">
                                               <h:outputText value="#{item.deleted}"/>
                                           </f:facet>
                                           <f:facet name="input">
                                               <p:inputText value="#{item.deleted}" label="#{configMapController.getKey('ListNotesTitle_deleted')}" />
                                           </f:facet>
                                       </p:cellEditor> 
   
   
                                   </p:column>
                                   <p:column sortBy="#{item.userId}" filterBy="#{item.userId}" headerText="#{configMapController.getKey('ListNotesTitle_userId')}"   >
                                       <p:cellEditor> 
                                           <f:facet name="output">
                                               <h:outputText value="#{item.userId.firstname} #{item.userId.lastname}"/>
                                           </f:facet>
                                           <f:facet name="input">
                                               <p:inputText value="#{item.userId}" label="#{configMapController.getKey('ListNotesTitle_userId')}" />
                                           </f:facet>
                                       </p:cellEditor> 
   
   
                                   </p:column>-->
                                <p:column rendered="#{notesController.isUserInRole('ADMIN')}"  headerText="Edit" style="width:50px">  
                                    <p:rowEditor />  
                                </p:column>  

                                <p:column>
                                    <p:commandButton rendered="#{notesController.isUserInRole('ADMIN')}"  oncomplete="notesControllerTable.filter()" update=":growl"  value="#{configMapController.getKey('ListNotesDestroyLink')}">
                                        <f:setPropertyActionListener value="#{item}" target="#{customersController.selectedNoteForDeletion}" />
                                    </p:commandButton>                        

                                </p:column>
                            </p:dataTable>
                        </h:panelGroup>
                    </h:form>

                </p:tab>
            </p:tabView>  
            <ui:include src="Create.xhtml"/>
            <ui:include src="CreateSchedule.xhtml"/>
            <ui:include src="CreatePayment.xhtml"/>
        </ui:define>
    </ui:composition>

</html>
